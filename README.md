# ghkd

ghkd is a lightweight, distribution-agnostic hotkey daemon for Linux written in Go. It interfaces directly with the Linux kernel input subsystem (evdev), allowing it to function independently of the display server (works on Wayland, X11, and TTY).

## Features

- **Display Server Agnostic:** Direct evdev implementation means it works regardless of your window manager or desktop environment.
- **Three Execution Modes:**
    - **Run:** Execute simple shell commands.
    - **Script:** Embed scripts (Bash, Python, Node, etc.) directly in the config.
    - **File:** Execute external script files.
- **Smart Device Detection:** Automatically detects keyboard devices and filters out mice or other input peripherals.
- **Graceful Shutdown:** Handles `SIGINT`/`SIGTERM` to safely terminate running child processes and clean up temporary files before exiting.
- **Async Execution:** Runs commands asynchronously without blocking input processing.

## Requirements

- Linux
- Go 1.21+ (to build)
- User privileges: Root or membership in the `input` group

## Installation

```bash
git clone https://github.com/yourusername/ghkd.git
cd ghkd
go build -o ghkd ./cmd/ghkd
```

## Running

ghkd reads directly from `/dev/input/event*`. You must have permission to read these files.

**Option 1: Input Group (Recommended)**
Add your user to the input group. You must log out and log back in for this to take effect.

```bash
sudo usermod -aG input $USER
```

**Option 2: Root**

```bash
sudo ./ghkd
```

## Configuration

The daemon looks for a `config.yaml` file.

### Structure

```yaml
settings:
    log_level: info

keybindings:
    # Action Type 1: Simple Command
    - name: Terminal
      keys: ctrl+alt+t
      run: alacritty

    # Action Type 2: Inline Script
    # Automatically handles temp file creation and cleanup
    - name: System Info
      keys: super+i
      interpreter: python3
      script: |
          import platform
          print(f"System: {platform.system()}")

    # Action Type 3: External File
    # Supports tilde expansion (~)
    - name: Backup
      keys: super+b
      file: ~/scripts/backup.sh
```

### Action Types

1.  **run**: Executes the string in a shell.
2.  **script**: Requires `interpreter` (e.g., `bash`, `python3`). Writes content to a secure temporary file, executes it, and deletes it upon completion.
3.  **file**: Executes an existing file on disk.

### Key Syntax

Keys are case-insensitive. Combine modifiers and keys with `+`.

- **Modifiers:** `ctrl`, `alt`, `shift`, `super`
- **Keys:** `a-z`, `0-9`, `f1-f12`
- **Special:** `enter`, `space`, `tab`, `esc`, `backspace`, `print`, `delete`, `home`, `end`
- **Media:** `volumeup`, `volumedown`, `mute`, `playpause`, etc.

## Shutdown

Pressing `Ctrl+C` triggers a graceful shutdown:

1.  Stops the keyboard listener.
2.  Sends `SIGTERM` to all currently running commands.
3.  Waits up to 5 seconds for processes to exit.
4.  Force kills any remaining processes.
5.  Cleans up temporary files generated by inline scripts.
